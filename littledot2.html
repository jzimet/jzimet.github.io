<!DOCTYPE html>
<HTML>
<HEAD>
<TITLE> CLoud Tool </TITLE>
<style>
canvas#mycanvas {border: solid gray 1px}
body {
    font-family: sans-serif;
    padding: 10px;
}
h1 {
    font-weight: bold;
}
label {
    font-size: small;
}
#controls {
    padding-bottom: 5px;
    border-bottom: 1px solid #000;
}
</style>
</HEAD>
<BODY>
<CENTER>
<h1>WebSQL for LD</h1>

<canvas id="can2" width="150" height="150" style="border:1px dashed #CCC;">revenue per doctor</canvas>
<canvas id="can3" width="150" height="150" style="border:1px dashed #CCC;">revenue per service</canvas>
<canvas id="can4" width="150" height="150" style="border:1px dashed #CCC;">revenue per platform</canvas>
<canvas id="can7" width="300" height="150" style="border:1px dashed #CCC;">revenue per platform</canvas>
<br />
<br />

<label>Select Doctors:<select id="doctordropdownlist" onchange="selectDoctor()"></select></label>

<label>Pacients:<select id="pacientdropdownlist" onchange="selectPacient()"></select></label>

<!--
<label>Selected pacient:<input type = "text" id="selectedpacient" onchange="selectPacient()"></label>
<br />
-->

<label>Services:<select id="servicedropdownlist" onchange="selectService()"></select></label>

<!--
<label>selected service:<input type = "text" id="selectedservice" onchange="selectService()"></label>
<br />
-->

<label>Platforms:<select id="platformdropdownlist" onchange="selectPlatform()"></select></label>



<!--
<label>selected Platform:<input type = "text" id="selectedplatform" onchange="selectPlatform()"></label>
<br />
-->

<br />
<br />
<!--
<label>selected doctors:<input type = "text" id="selecteddoctor" onchange="selectDoctor()"></label>
-->

<canvas id="can5" width="150" height="150" style="border:1px dashed #CCC;"></canvas>
<canvas id="mycanvas1" width="150" height="150" style="border:1px dashed #CCC;"></canvas>
<canvas id="mycanvas2" width="150" height="150" style="border:1px dashed #CCC;"></canvas>
<canvas id="mycanvas3" width="150" height="150" style="border:1px dashed #CCC;"></canvas>
<br />
<canvas id="can6" width="150" height="150" style="border:1px dashed #CCC;"></canvas>
<canvas id="mycanvas4" width="150" height="150" style="border:1px dashed #CCC;"></canvas>
<canvas id="mycanvas5" width="150" height="150" style="border:1px dashed #CCC;"></canvas>
<canvas id="mycanvas6" width="150" height="150" style="border:1px dashed #CCC;"></canvas>
<br />

<!--
<label>Pacients:<select id="pacientdropdownlist" onchange="selectPacient()"></select></label>
<label>Selected pacient:<input type = "text" id="selectedpacient" onchange="selectPacient()"></label>
<br />
<label>Services:<select id="servicedropdownlist" onchange="selectService()"></select></label>
<label>selected service:<input type = "text" id="selectedservice" onchange="selectService()"></label>
<br />
<label>Platforms:<select id="platformdropdownlist" onchange="selectPlatform()"></select></label>
<label>selected Platform:<input type = "text" id="selectedplatform" onchange="selectPlatform()"></label>
<br />
-->

<table><tr><td>
<div id="controls">

<!--
    <p>Add entry to the database</p>
-->
        <label>Doctor :
        <select id="doctor">
                <option value = "doctor1">Doctor 1</option>
                <option value = "doctor2">Doctor 2</option>
                <option value = "doctor3">Doctor 3</option>
                <option value = "doctor4">Doctor 4</option>
        </select>
        </label>
    <br />
<!--
    <label>Doctor:</label>
    <input type="text" id="doctor" />
    <br />
-->


    <label>Pacient :
        <select id="pacient">
                <option value = "pacient1">Pacient 1</option>
                <option value = "pacient2">Pacient 2</option>
                <option value = "pacient3">Pacient 3</option>
                <option value = "pacient4">Pacient 4</option>
        </select>
        </label>
    <br />


<!--
    <label>Pacient:</label>
    <input type="text" id="pacient" />
    <br />
-->
    	<label>Service :
	<select id="service">
		<option value = "calldoctor">Call Doctor</option>
		<option value = "consultation">Consultation</option>
		<option value = "secondopinion">Second Opinion</option>
	</select>
	</label>
    <br />
<!--
   <label>Service :</label>
   <input type="text" id="service" />
    <br />
-->

    <label>Zone :
    <select id="zone">
            <option value = "bolesti"></option>
            <option value = "cijepljenje">Cijepljenje</option>
            <option value = "doctor">Doctor</option>
            <option value = "hranjenje">Hranjenje</option>
            <option value = "kljucnitrenuci">Kljucni trenuci</option>
            <option value = "lijekovi">Lijekovi</option>
            <option value = "ostalo">Ostalo</option>
            <option value = "rastirazvoj">Rast i razvoj</option>
            <option value = "spavanje">Spavanje</option>
            <option value = "temperatura">Temperatura</option>
            <option value = "zubi">Zubi</option>
     </select>
     </label>
    <br />

<!--
    <label>Zone:</label>
    <input type="text" id="zone" />
    <br />
-->

    <label>Ad :
    <select id="ad">
            <option value = "apetito">Apetito</option>
            <option value = "avenetermalnavoda">Avene termalna voda</option>
            <option value = "Bronhostop">Bronhostop</option>
            <option value = "Cicalfate">Cicalfate</option>
            <option value = "Cicatridina">Cicatridina</option>
            <option value = "Dermalibour+">Dermalibour+</option>
            <option value = "Echinax">Echinax</option>
            <option value = "Exomegap">Exomega</option>
            <option value = "Isilax">Isilax</option>
            <option value = "Primalba">Primalba</option>
            <option value = "Reidrato">Reidrato</option>
     </select>
     </label>
    <br />

<!--
<label>Ad :</label>
    <input type="text" id="ad" />
    <br />
-->

    <label>Datum :</label>
    <input type="date" id="date" value="2017-02-02" />
    <br />

    <label>Start:</label>
    <input type="time" id="start" value="00:00" />
    <br />

    <label>End :</label>
    <input type="time" id="end" value="00:00" />
    <br />

    <label>Duration:</label>
    <input type="time" id="duration" value="00:00" />
    <br />

    <label>Price:</label>
    <input type="text" id="price" value="100" />
    <br />

    <label>Invoice :</label>
    <input type="text" id="invoice" value="click"/>
    <br />

        <label>Platform :
        <select id="platform">
                <option value = "ios">IOS</option>
                <option value = "android">Android</option>
                <option value = "web">Web</option>
        </select>
        </label>
    <br />


<!--
    <label>Platform:</label>
    <input type="text" id="platform" />
    <br />
-->
    <br />
<!--
    <button type="button" id="addcar" style="height:30px; width:200px" onclick="addCar();">Add</button>
-->
</td>
<td>
<button type="button" id="addcar" style="height:30px; width:200px" onclick="addCsv();">Add To database</button>
<br />
<br />
<br />
<!--
<label for="csvFileInput"> <strong>Import from CSV File:</strong></label>
-->
<input type="file" id="csvFileInput" style="height:30px; width:200px" onchange="handleFiles(this.files)" accept=".csv">
<div id="output"></div>
<br />
<br />
<!--
<label for="printcsv"> <strong>Print CSV File:</strong></label>
-->
<button type="button" id="printcsv" style="height:30px; width:200px" onclick="printCsv();">Print CSV</button>
<br />
<br />
</td>
</tr>
</table>
</div>

<!--
</td>

<td>

<div id="carlistholder">
     <h3>Your Data</h3>
        <ul id="carlist"></ul>
</div>
</td>
-->

<!--
<td>
    <label>ios:</label>
    <input type="number" id="doctoriosrevenue" value="0"/>
    <input type="number" id="doctoriosrevenuepercentage" value="0"/>%
    <br />
    <label>adnroid:</label>
    <input type="number" id="doctorandroidrevenue" value="0"/>
    <input type="number" id="doctorandroidrevenuepercentage" value="0"/>%
    <br />
    <label>web:</label>
    <input type="number" id="doctorwebrevenue" value="0"/>
    <input type="number" id="doctorwebrevenuepercentage" value="0"/>%
    <br />
    <label>total:</label>
    <input type="number" id="doctortotalrevenue" value="0"/>
    <br />
    <label>total:</label>
    <input type="number" id="test1" value="0"/>
    <input type="number" id="test2" value="0"/>
    <input type="number" id="test3" value="0"/>
    <br />
</td>
<td>
</td>
-->

</td>

<!--
</div>
<br />
-->
<!--

<div id="carlistholder">
     <h3>Your Data</h3>
	<ul id="carlist"></ul>
</div>
-->
<!--
<div id="doctorlistholder">
     <h3>Your Doctors</h3>
       <ul id="doctorlist"></ul>
</div>
<div id="pacientlistholder">
     <h3>Your Pacient</h3>
       <ul id="pacientlist"></ul>
</div>
<div id="servicelistholder">
     <h3>Your Services</h3>
       <ul id="servicelist"></ul>
</div>
<div id="platformlistholder">
     <h3>Your platform</h3>
       <ul id="platformlist"></ul>
</div>
-->
<div id="graphsholder">
     <h3></h3>
	<ul id="graphs"></ul>
</div>

<!--
<p><strong>Note: </strong>You can leave this page and when you return the cars you entered will still be here!</p>A
-->

<!--
<table>
<tr>
<td>
    <label>City:</label>
    <input type="text" id="city" value="city" />
    <br />

    <label>Temperature:</label>
    <input type="text" id="temperature" value="temperature" />
    <br />

    <label>Conditions:</label>
    <input type="text" id="conditions" value="conditions" />
    <br />

-->
<!--
    <label>Doctor:</label>
    <input type="text" id="csvdr" value="doctor" />
    <br />

    <label>Pacient:</label>
    <input type="text" id="csvpacient" value="pacient" />
    <br />

    <label>Service:</label>
    <input type="text" id="csvservice" value="service" />
    <br />


    <label>zone:</label>
    <input type="text" id="csvzone" value="zone" />
    <br />

    <label>Ad:</label>
    <input type="text" id="csvad" value="ad" />
    <br />

    <label>datum:</label>
    <input type="text" id="csvdatum" value="datum" />
    <br />


    <label>od:</label>
    <input type="text" id="csvod" value="od" />
    <br />

    <label>do:</label>
    <input type="text" id="csvdo" value="Till" />
    <br />

    <label>trajanje:</label>
    <input type="text" id="csvtrajanje" value="trajanje" />
    <br />


    <label>price:</label>
    <input type="text" id="csvprice" value="price" />
    <br />


    <label>invoice:</label>
    <input type="text" id="csvinvoice" value="invoice" />
    <br />

    <label>platform:</label>
    <input type="text" id="csvplatform" value="platform" />
    <br />

   <label for="addcsv"> <strong>Add  CSV:</strong></label>
   <button type="button" id="addscv" onclick="addCsv();">Add Entry to Database</button>

</td>
<td> 
-->
<!--
<div id="csvholder">
     <h3>Your csv</h3>
        <ul id="csvlist"></ul>
</div>

</td>
</tr>
</table>
-->

<!--
<label>City:<select id="csvdropdownlist"></select></label>
-->


<div id="dvxTable">
</div>

<script>
//Test for browser compatibility
if (window.openDatabase) {
    //Create the database the parameters are 1. the database name 2.version number 3. a description 4. the size of the database (in bytes) 1024 x 1024 = 1MB
    var mydb = openDatabase("ld6_db", "0.1", "A Database of Cars I Like", 1024 * 1024);
    var mydb2 = openDatabase("test_db", "0.1", "A Database of Cars I Like", 1024 * 1024);

    //create the cars table using SQL for the database using a transaction
    mydb.transaction(function (t) {
        t.executeSql("CREATE TABLE IF NOT EXISTS cars (id INTEGER PRIMARY KEY ASC, make TEXT, model TEXT, doctor TEXT, pacient TEXT, service TEXT, zone TEXT, ad TEXT, date TEXT, start DATE, end DATE, duration INTEGER, price INTEGER, invoice TEXT, platform TEXT)");
    });
    //mydb2.transaction(function (t) {
        //t.executeSql("CREATE TABLE IF NOT EXISTS test4 (id INTEGER PRIMARY KEY ASC, city  TEXT, temperature TEXT, conditions TEXT)");
    //});

    mydb2.transaction(function (t) {
        //t.executeSql("CREATE TABLE IF NOT EXISTS ld (id INTEGER PRIMARY KEY ASC, doctor TEXT, pacient TEXT, service TEXT, zone TEXT, ad TEXT, datum TEXT, od TEXT, do TEXT, trajanje TEXT, price TEXT, invoice TEXT, platform TEXT)");
        t.executeSql("CREATE TABLE IF NOT EXISTS cars (id INTEGER PRIMARY KEY ASC, make TEXT, model TEXT, doctor TEXT, pacient TEXT, service TEXT, zone TEXT, ad TEXT, date TEXT, start DATE, end DATE, duration INTEGER, price INTEGER, invoice TEXT, platform TEXT)");
    });


} else {
    alert("WebSQL is not supported by your browser!");
}

//http://www.braingia.org/webnotes/2016/02/07/parsing-a-csv-with-javascript/
function handleFiles(files) {
        // Check for the various File API support.
        if (window.FileReader) {
                // FileReader are supported.
                getAsText(files[0]);
        } else {
                alert('FileReader are not supported in this browser.');
        }
}

function getAsText(fileToRead) {
        var reader = new FileReader();
        // Handle errors load
        reader.onload = loadHandler;
        reader.onerror = errorHandler;
        // Read file into memory as UTF-8
        reader.readAsText(fileToRead);
}

function loadHandler(event) {
        var csv = event.target.result;
        processData(csv);
}


//function processData(csv) {
//    var allTextLines = csv.split(/\r\n|\n/);
//    var lines = [];
//    while (allTextLines.length) {
//        lines.push(allTextLines.shift().split(','));
//    }
//        console.log(lines);
//        drawOutput(lines);
//}



function processData(csv) {
        var allTextLines = csv.split(/\r\n|\n/);
        var lines = [];
        for (var i=0; i<allTextLines.length-1; i++) {
            var data = allTextLines[i].split(';');
                var tarr = [];
                for (var j=0; j<data.length; j++) {
                    tarr.push(data[j]);
                }
                lines.push(tarr);

	document.getElementById("csvdr").value=tarr[0];
	document.getElementById("csvpacient").value=tarr[1];
 	document.getElementById("csvservice").value=tarr[2];
 	document.getElementById("csvzone").value=tarr[3];
 	document.getElementById("csvad").value=tarr[4];
 	document.getElementById("csvdatum").value=tarr[5];
 	document.getElementById("csvod").value=tarr[6];
 	document.getElementById("csvdo").value=tarr[7];
 	document.getElementById("csvtrajanje").value=tarr[8];
 	document.getElementById("csvprice").value=tarr[9];
 	document.getElementById("csvinvoice").value=tarr[10];
 	document.getElementById("csvplatform").value=tarr[11];


	if (i == 0) {

		dropTableCsv();
		createTableCsv();

	} else {
	
		addCsv();

	}	

	}
	console.log(lines);
	drawOutput(lines);
//	outputCsv(); 
//	printCsv();

}

function errorHandler(evt) {
        if(evt.target.error.name == "NotReadableError") {
                alert("Canno't read file !");
        }
}

function drawOutput(lines){
        //Clear previous data
        document.getElementById("output").innerHTML = "";
        var csvholder = document.getElementById("csvlist");
        csvholder.innerHTML = "";
        //csvholder.innerHTML += "<li>" + "linije u csv: " + lines.length;
	//csvholder.innerHTML += "<li>" + "polja u liniji: " + lines[0].length;
	//csvholder.innerHTML += "<li>" + lines[0][0] + "-" + lines[0][1] + "-" + lines[0][2];
	//csvholder.innerHTML += "<li>" + lines[1][0] + "-" + lines[1][1] + "-" + lines[1][2];
	//csvholder.innerHTML += "<li>" + lines[2][0] + "-" + lines[2][1] + "-" + lines[2][2];
	//csvholder.innerHTML += "<li>" + lines[3][0] + "-" + lines[3][1] + "-" + lines[3][2];

        var table = document.createElement("table");
        for (var i = 0; i < lines.length; i++) {
                var row = table.insertRow(-1);
		for (var j = 0; j < lines[i].length; j++) {
                        var firstNameCell = row.insertCell(-1);
                        firstNameCell.appendChild(document.createTextNode(lines[i][j]));
	                //csvholder.innerHTML += "<li>" + "lines" + i + "length :" + lines[i].length;
	                //csvholder.innerHTML += "<li>" + "lines" + i + j + "content :" + lines[i][j];
		}
	}
	
	document.getElementById("output").appendChild(table);
	outputCsv();
    	if (mydb2) {
		mydb2.transaction(function (t) {
        		t.executeSql("SELECT * FROM ld", [],function (t, results) {
    			var i;
    			var csvdropdown="";
    			//Iterate through the results
    			for (i = 0; i < results.rows.length; i++) {
        			//Get the current row
        			var row = results.rows.item(i);
          			//csvdropdown=csvdropdown + "<option value="+row.id + ">" + row.id + "-" + row.doctor + "-" + row.pacient + row.service + "</option>";
        			}
    			//document.getElementById("csvdropdownlist").innerHTML=csvdropdown;
			});
		});

         } else {
                alert("You must enter a doctor and pacient and service  and platform!");
         }
}

function addCsv() {
    //check to ensure the mydb object has been created
    if (mydb2) {
        //get the values of the make and model text inputs
        //var doctor = document.getElementById("csvdr").value;
        //var pacient = document.getElementById("csvpacient").value;
        //var service = document.getElementById("csvservice").value;
        //var zone = document.getElementById("csvzone").value;
        //var ad = document.getElementById("csvad").value;
        //var datum = document.getElementById("csvdatum").value;
        //var od = document.getElementById("csvod").value;
        //var till = document.getElementById("csvdo").value;
        //var trajanje = document.getElementById("csvtrajanje").value;
        //var price = document.getElementById("csvprice").value;
        //var invoice = document.getElementById("csvinvoice").value;
        //var platform = document.getElementById("csvplatform").value;



        var doctor = document.getElementById("doctor").value;
        var pacient = document.getElementById("pacient").value;
        var service = document.getElementById("service").value;
        var zone = document.getElementById("zone").value;
        var ad = document.getElementById("ad").value;
        var datum = document.getElementById("date").value;
        var od = document.getElementById("start").value;
        var till = document.getElementById("end").value;
        var trajanje = document.getElementById("duration").value;
        var price = document.getElementById("price").value;
        var invoice = document.getElementById("invoice").value;
        var platform = document.getElementById("platform").value;


        //Test to ensure that the user has entered both a make and model
        if (doctor !== "" && pacient !== "" && service !=="") {
            //Insert the user entered details into the cars table, note the use of the ? placeholder, these will replaced by the data passed in as an array as the second parameter
            mydb2.transaction(function (t) {
                t.executeSql("INSERT INTO ld (doctor, pacient, service, zone, ad, datum, od, do, trajanje, price, invoice, platform) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)", [doctor, pacient, service, zone, ad, datum, od, till, trajanje, price, invoice, platform]);
                outputCsv();
            });
        } else {
            alert("You must enter a doctor and pacient and service  and platform!");
        }
    } else {
        alert("db not found, your browser does not support web sql!");
    }
}



//function to remove a car from the database, passed the row id as it's only parameter
function deleteCsv(id) {
    //check to ensure the mydb object has been created
    if (mydb2) {
        //Get all the cars from the database with a select statement, set outputCarList as the callback function for the executeSql command
        mydb2.transaction(function (t) {
            t.executeSql("DELETE FROM ld WHERE id=?", [id], outputCsv);
        });
    } else {
        alert("db not found, your browser does not support web sql!");
    }
}

//function to output the list of cars in the database
function updateCsvList(transaction, results) {
    //initialise the listitems variable
    //var listitems = "";
    //get the car list holder ul
    var csvholder = document.getElementById("csvlist");
    //var csvdropdown=document.getElementById("csvdropdownlist");

    //clear cars list ul
    //csvholder.innerHTML = "";
    //csvdropdown = "";

    var i;
	var xtable = document.createElement("TABLE");
    //csvholder.innerHTML += "<li>" + "id - doctor - pacient - service - zone - ad - datum - od - do - trajanje - price - invoice - platform - delete";
    //Iterate through the results
    for (i = 0; i < results.rows.length; i++) {
        //Get the current row
        var row = results.rows.item(i);



                                        var row = results.rows.item(i);
                                        xrow = xtable.insertRow(-1);
                                        var xcell0 = xrow.insertCell(0);
                                        xcell0.innerHTML = row.id;
                                        var xcell1 = xrow.insertCell(1);
                                        xcell1.innerHTML = row.doctor;
                                        var xcell2 = xrow.insertCell(2);
                                        xcell2.innerHTML = row.pacient;
                                        var xcell3 = xrow.insertCell(3);
                                        xcell3.innerHTML = row.service;
                                        var xcell4 = xrow.insertCell(4);
                                        xcell3.innerHTML = row.zone;
                                        var xcell5 = xrow.insertCell(5);
                                        xcell5.innerHTML = row.ad;
                                        var xcell6 = xrow.insertCell(6);
                                        xcell6.innerHTML = row.datum;
                                        var xcell7 = xrow.insertCell(7);
                                        xcell7.innerHTML = row.od;
                                        var xcell8 = xrow.insertCell(7);
                                        xcell8.innerHTML = row.do;
                                        var xcell9 = xrow.insertCell(9);
                                        xcell9.innerHTML = row.trajanje;
                                        var xcell10 = xrow.insertCell(10);
                                        xcell10.innerHTML = row.price;
                                        var xcell11 = xrow.insertCell(11);
                                        xcell11.innerHTML = row.invoice;
                                        var xcell12 = xrow.insertCell(12);
                                        xcell12.innerHTML = row.platform;
                                        var xcell13 = xrow.insertCell(13);
                                        xcell13.innerHTML = "(<a href='javascript:void(0);' onclick='deleteCsv(" + row.id + ");'>Delete</a>)";


        //csvholder.innerHTML += "<li>" + row.id +" - " +  row.doctor + " - " + row.pacient +  "-"  + row.service + "-" + row.zone + "-" + row.ad + "-" + row.datum + "-" + row.od + "-" + row.do + "-" + row.trajanje + "-" + row.price + "-" + row.invoice + "-" + row.platform +  " (<a href='javascript:void(0);' onclick='deleteCsv(" + row.id + ");'>Delete</a>)";
        //csvdropdown.innerHTML += csvdropdown + "<option value="+row.id + ">" + row.id + "-" + row.city + "-" + row.temperature + row.conditions + "</option>";
    }
                       var dvxTable = document.getElementById("dvxTable");
                        dvxTable.innerHTML = "";
                        dvxTable.appendChild(xtable);
}

//function to get the list of cars from the database
function outputCsv() {
    //check to ensure the mydb object has been created
    if (mydb2) {
        //Get all the cars from the database with a select statement, set outputCarList as the callback function for the executeSql command
        mydb2.transaction(function (t) {
            t.executeSql("SELECT * FROM ld", [], updateCsvList);
        });
    } else {
        alert("db not found, your browser does not support web sql!");
    }
}



function printCsv() {
    //check to ensure the mydb object has been created
    if (mydb2) {
        mydb2.transaction(function (t) {
                t.executeSql("SELECT * FROM ld ", [],function (t, results) {
    			var csvholder = document.getElementById("csvlist");
			var xtable = document.createElement("TABLE");
    			//xtable.border = "1";
			//xrow = xtable.insertRow(-1);	    			
//csvholder.innerHTML = "";
        		//csvholder.innerHTML += "<li>" + "id - doctor - pacient - service - zone - ad - datum - od - do - trajanje - price - invoice - platform - delete";
        		//csvholder.innerHTML += "<table><tr><th>id</th><th>doctor</th><th>pacient</th><th>service</th><th>zone</th><th>ad</th><th>datum</th><th>od</th><th>do</th><th>trajanje</th><th>price</th><th>invoice</th><th>platform</th><th>delete</th></tr>";
                                for (i = 0; i < results.rows.length; i++) {
                                        var row = results.rows.item(i);
					xrow = xtable.insertRow(-1);	    			
					var xcell0 = xrow.insertCell(0);
					xcell0.innerHTML = row.id;
					var xcell1 = xrow.insertCell(1);
					xcell1.innerHTML = row.doctor;
					var xcell2 = xrow.insertCell(2);
					xcell2.innerHTML = row.pacient;
					var xcell3 = xrow.insertCell(3);
                                        xcell3.innerHTML = row.service;
					var xcell4 = xrow.insertCell(4);
                                        xcell3.innerHTML = row.zone;
					var xcell5 = xrow.insertCell(5);
                                        xcell5.innerHTML = row.ad;
					var xcell6 = xrow.insertCell(6);
                                        xcell6.innerHTML = row.datum;
					var xcell7 = xrow.insertCell(7);
                                        xcell7.innerHTML = row.od;
					var xcell8 = xrow.insertCell(7);
                                        xcell8.innerHTML = row.do;
					var xcell9 = xrow.insertCell(9);
                                        xcell9.innerHTML = row.trajanje;
					var xcell10 = xrow.insertCell(10);
                                        xcell10.innerHTML = row.price;
					var xcell11 = xrow.insertCell(11);
                                        xcell11.innerHTML = row.invoice;
					var xcell12 = xrow.insertCell(12);
                                        xcell12.innerHTML = row.platform;
					var xcell13 = xrow.insertCell(13);
                                        xcell13.innerHTML = "(<a href='javascript:void(0);' onclick='deleteCsv(" + row.id + ");'>Delete</a>)";
					
        				//var csvholder = document.getElementById("csvlist");
        				//csvholder.innerHTML += "<li>" + row.id +" - " +  row.doctor + " - " + row.pacient +  "-"  + row.service + "-" + row.zone + "-" + row.ad + "-" + row.datum + "-" + row.od + "-" + row.do + "-" + row.trajanje + "-" + row.price + "-" + row.invoice + "-" + row.platform + " (<a href='javascript:void(0);' onclick='deleteCsv(" + row.id + ");'>Delete</a>)";
        				//csvholder.innerHTML += "<tr><td>" + row.id +  "</td><td>" +  row.doctor + "</td><td>"  + row.pacient +  "</td><td>"   + row.service + "</td><td>"  + row.zone + "</td><td>"  + row.ad + "</td><td>"  + row.datum + "</td><td>"  + row.od + "</td><td>"  + row.do + "</td><td>"  + row.trajanje + "</td><td>"  + row.price + "</td><td>"  + row.invoice + "</td><td>"  + row.platform + "</td><td>" +  "(<a href='javascript:void(0);' onclick='deleteCsv(" + row.id + ");'>Delete</a>)" + "</td></tr>";
                                }
    			//csvholder.innerHTML += "</table>";
			var dvxTable = document.getElementById("dvxTable");
    			dvxTable.innerHTML = "";
    			dvxTable.appendChild(xtable);
                });
        });

    } else {
        alert("db not found, your browser does not support web sql!");
    }
}



function dropTableCsv() {
    if (mydb2) {
        mydb2.transaction(function (t) {
                t.executeSql("DROP TABLE ld", [],function (t, results) {
			console.error("Table droped");
                });
        });
    } else {
        alert("db not found, your browser does not support web sql!");
    }
}



function createTableCsv() {
    if (mydb2) {

        //get the values of the make and model text inputs
        //var city = document.getElementById("city").value;
        //var temperature = document.getElementById("temperature").value;
        //var conditions = document.getElementById("conditions").value;

        //mydb2.transaction(function (t) {
        //	t.executeSql("CREATE TABLE IF NOT EXISTS test4 (id INTEGER PRIMARY KEY ASC, city  TEXT, temperature TEXT, conditions TEXT)") 
        //});


        mydb2.transaction(function (t) {
        	t.executeSql("CREATE TABLE IF NOT EXISTS ld (id INTEGER PRIMARY KEY ASC, doctor TEXT, pacient TEXT, service TEXT, zone TEXT, ad TEXT, datum TEXT, od TEXT, do TEXT, trajanje TEXT, price TEXT, invoice TEXT, platform TEXT)");
        });

    } else {
        alert("db not found, your browser does not support web sql!");
    }
}


//function to get the list of cars from the database
    if (mydb2) {


        //Get all the cars from the database with a select statement, set outputCarList as the callback function for the executeSql command
        mydb2.transaction(function (t) {

            t.executeSql("SELECT * FROM ld group by doctor", [],function (t, results) { 
		var listitems = "";
    		var listholder = document.getElementById("graphs");
    		listholder.innerHTML = "";
		var totalrevenue = 0;
                var j;
    		var i;
		var doctorrevenue = [0, 0, 0, 0];
		var doctor = ["a", "b", "c", "d"];
		var canvas2 = document.getElementById("can2");
		var ctx2 = canvas2.getContext("2d");
		ctx2.clearRect(0,0,canvas2.width, canvas2.height);
		var lastend = 0;
		var cw=ctx2.canvas.width/2;
		var ch=ctx2.canvas.height/2;	
		var radius = ch/1.5
		var myColor = ['red','green','blue', 'yellow'];
                ctx2.textAlign = 'center';
    		//Iterate through the results
    		for (i = 0; i < results.rows.length; i++) {
        		//Get the current row
        		var row = results.rows.item(i);
			doctor[i]=row.doctor;
    		}
        	mydb2.transaction(function (t) {
            		t.executeSql("SELECT * FROM ld", [],function (t, results) {
                	//Iterate through the results
                		for (i = 0; i < results.rows.length; i++) {
                        		//Get the current row
                        		var row = results.rows.item(i);
					totalrevenue += parseInt(row.price);
                			for (j = 0; j < doctor.length; j++) {
                                		if (row.doctor == doctor[j]) {
                                        		doctorrevenue[j]+= parseInt(row.price);
                                		}
						if ((i+1)  == results.rows.length) {
							ctx2.fillStyle = myColor[j];
							ctx2.beginPath();
							ctx2.moveTo(cw,ch);
					
							ctx2.arc(cw,ch,ch,lastend,lastend+(Math.PI*2*(doctorrevenue[j]/totalrevenue)),false);
							ctx2.fill();
                                        		ctx2.fillStyle = 'white';
                                        		ctx2.beginPath();
                                        		ctx2.moveTo(cw,ch);
                                        		ctx2.arc(cw,ch,(ch-3),0,2*Math.PI,false);
                                        		ctx2.fill();

							ctx2.fillStyle = "blue";
                					ctx2.font="bold 14px bebas"
							ctx2.fillText(totalrevenue+'HRK', cw+2, ch+4, cw);
                					ctx2.font="bold 14px bebas"
							ctx2.fillText('revenue per doctors', cw+2, ch+14, cw);

							lastend += Math.PI * 2 * (doctorrevenue[j]/totalrevenue);

						}
                			}	
                		}
        		});
        	});
        });




	t.executeSql("SELECT * FROM ld group by doctor", [],function (t, results) {
                var listitems = "";
                var listholder = document.getElementById("graphs");
                var totalrevenue = 0;
                var doctorrevenue = [0, 0, 0];
                var servicerevenue = [0, 0, 0];
                var doctor = ["a", "b", "c"];
                var service = ["a", "b", "c"];
                var myColor = ['red','green','blue', 'yellow'];
                var j;
                var i;
                listholder.innerHTML = "";
                //listholder.innerHTML += "z=:"  + z;



                                        var canvas2 = document.getElementById("can7");
                                        var ctx2 = canvas2.getContext("2d");
                                        var width2 = canvas2.width/12;
                                        var currX2 = 0;
                                        var base2 = 200;
					//var h2 = 0;
                                        ctx2.clearRect(0, 0, canvas2.width, canvas2.height);


                //Iterate through the results
                for (i = 0; i < results.rows.length; i++) {
                        //Get the current row
                        var row = results.rows.item(i);
                        doctor[i]=row.doctor;
                }
		 //Iterate through the results
                for (i = 0; i < results.rows.length; i++) {
                        //Get the current row
                        var row = results.rows.item(i);
                        service[i]=row.service;
                }
                mydb2.transaction(function (t) {
                        t.executeSql("SELECT * FROM ld", [],function (t, results) {
                        //Iterate through the results
                        for ( z = 1; z < 13; z++) {        
                        	currX2 += width2;
				//h2=0;
				for (j = 0; j < doctor.length; j++) {
                                	doctorrevenue[j]=0; 
                                }
				for (j = 0; j < service.length; j++) {
                                	servicerevenue[j]=0;
                                }
				for (i = 0; i < results.rows.length; i++) {
                                        //Get the current row
                                        var row = results.rows.item(i);
                                        totalrevenue += parseInt(row.price);
                                        for (j = 0; j < doctor.length; j++) {
						if (row.datum == z) {
							if (row.doctor == doctor[j]) {
                                                        	doctorrevenue[j]+= parseInt(row.price);
                                                		//listholder.innerHTML += "gotit:"  + doctorrevenue[j];
							}
						}
					}

					for (j = 0; j < service.length; j++) {
                                                if (row.datum == z) {
                                                        if (row.service== service[j]) {
                                                                servicerevenue[j]+= parseInt(row.price);
                                                                //listholder.innerHTML += "gotit:"  + servicerevenue[j];
                                                        }
                                                }
                                        }		
				}
				currY2 = canvas2.height/2;
				var bar = 0;
                		myColor = ['red','green','blue', 'yellow'];
                                for ( k=0; k< doctor.length;k++) {
					currY2 = currY2 - doctorrevenue[k]/10;
					bar = doctorrevenue[k]/10;
                                        ctx2.fillStyle = myColor[k];
                                        //context.fillRect(x,y,width,height)
					ctx2.fillRect((width2*z-width2/3*2),currY2,width2/5,bar);
                                        
				}
				currY2=canvas2.height/2;
				var bar = 0;
                		myColor = ['black','lightgreen','lightblue', 'pink'];
				for ( k=0; k< service.length;k++) {
                                	currY2 = currY2 - servicerevenue[k]/10;
					bar = servicerevenue[k]/10;
                                        ctx2.fillStyle = myColor[k];
					ctx2.fillRect((width2*z-width2/3),currY2,width2/5,bar);
                                        ctx2.fillStyle = 'blue';
                                        ctx2.fillText(z,(width2*z-width2/2),canvas2.height/3*2);
                                        ctx2.fillStyle = 'red';
                                        ctx2.fillText("revenue per doctor per month",0,canvas2.height);
                                        ctx2.fillStyle = 'black';
                                        ctx2.fillText("revenue per service per month",0,canvas2.height/7*6);
					ctx2.fillRect(currX2,canvas2.height/2,width2/40,5);
				}
			}
                        });
                });
        });
//}




            t.executeSql("SELECT * FROM ld group by service", [],function (t, results) {
                //var listitems = "";
                var listholder = document.getElementById("graphs");
                var totalrevenue = 0;
                var servicerevenue = [0, 0, 0, 0];
                var service = ["a", "b", "c", "d"];
                var j;
                var i;
                listholder.innerHTML = "";
                //piechart http://jsfiddle.net/hvYkM/1/:/AND

                //https://jsfiddle.net/rradik/kuqdwuyd/
                var canvas3 = document.getElementById("can3");
                var ctx3 = canvas3.getContext("2d");
                ctx3.clearRect(0,0,canvas3.width, canvas3.height);
                var lastend = 0;
                var cw3=ctx3.canvas.width/2;
                var ch3=ctx3.canvas.height/2;
                var radius3 = ctx3.canvas.height/1.5
                var myColor3 = ['red','green','blue', 'yellow'];
                ctx3.font="bold 14px bebas"
                ctx3.textAlign = 'center';
                //Iterate through the results
                for (i = 0; i < results.rows.length; i++) {
                        //Get the current row
                        var row = results.rows.item(i);
                        service[i]=row.service;
                }
                mydb2.transaction(function (t) {
                        t.executeSql("SELECT * FROM ld", [],function (t, results) {
                        //Iterate through the results
                                for (i = 0; i < results.rows.length; i++) {
                                        //Get the current row
                                        var row = results.rows.item(i);
                                        totalrevenue += parseInt(row.price);
                                        for (j = 0; j < service.length; j++) {
                                                if (row.service == service[j]) {
                                                        servicerevenue[j]+= parseInt(row.price);
                                                }
                                                if ((i+1)  == results.rows.length) {
                                                        ctx3.fillStyle = myColor3[j];
                                                        ctx3.beginPath();
                                                        ctx3.moveTo(cw3,ch3);

                                                        ctx3.arc(cw3,ch3,ch3,lastend,lastend+(Math.PI*2*(servicerevenue[j]/totalrevenue)),false);
                                                        ctx3.fill();
                                                        ctx3.fillStyle = 'white';
                                                        ctx3.beginPath();
                                                        ctx3.moveTo(cw3,ch3);
                                                        ctx3.arc(cw3,ch3,(ch3-3),0,2*Math.PI,false);
                                                        ctx3.fill();
                					ctx3.fillStyle = "blue";
                                                        ctx3.fillText(totalrevenue+'HRK', cw3+2, ch3+4, cw3);
                                                        ctx3.font="bold 14px bebas"
                                                        ctx3.fillText('revenue per services', cw3+2, ch3+14, cw3);
                                                        lastend += Math.PI * 2 * (servicerevenue[j]/totalrevenue);

                                                }
                                        }
                                }
                        });
                });
        });



            t.executeSql("SELECT * FROM ld group by platform", [],function (t, results) {
                //var listitems = "";
                var listholder = document.getElementById("graphs");
                var totalrevenue = 0;
                var platformrevenue = [0, 0, 0];
                var platform = ["a", "b", "c"];
                var j;
                var i;
                listholder.innerHTML = "";
                //piechart http://jsfiddle.net/hvYkM/1/
                //https://jsfiddle.net/rradik/kuqdwuyd/
                var canvas2 = document.getElementById("can4");
                var ctx2 = canvas2.getContext("2d");
                ctx2.clearRect(0,0,canvas2.width, canvas2.height);
                var lastend = 0;
                var cw=ctx2.canvas.width/2;
                var ch=ctx2.canvas.height/2;
                var radius = ctx2.canvas.height/1.5
                var myColor = ['red','green','blue', 'yellow'];
                ctx2.font="bold 14px bebas"
                ctx2.textAlign = 'center';
                //Iterate through the results
                for (i = 0; i < results.rows.length; i++) {
                        //Get the current row
                        var row = results.rows.item(i);
                        platform[i]=row.platform;
                }
                mydb2.transaction(function (t) {
                        t.executeSql("SELECT * FROM ld", [],function (t, results) {
                        //Iterate through the results
                                for (i = 0; i < results.rows.length; i++) {
                                        //Get the current row
                                        var row = results.rows.item(i);
                                        totalrevenue += parseInt(row.price);
                                        for (j = 0; j < platform.length; j++) {
                                                if (row.platform == platform[j]) {
                                                        platformrevenue[j]+= parseInt(row.price);
                                                }
                                                if ((i+1)  == results.rows.length) {
                                                        //document.getElementById(doctor[j]).innerHTML=platformrevenue[j];
                                                        ctx2.fillStyle = myColor[j];
                                                        ctx2.beginPath();
                                                        ctx2.moveTo(cw,ch);

                                                        ctx2.arc(cw,ch,ch,lastend,lastend+(Math.PI*2*(platformrevenue[j]/totalrevenue)),false);
                                                        ctx2.fill();
                                                        ctx2.fillStyle = 'white';
                                                        ctx2.beginPath();
                                                        ctx2.moveTo(cw,ch);
                                                        ctx2.arc(cw,ch,(ch-3),0,2*Math.PI,false);
                                                        ctx2.fill();
                					ctx2.fillStyle = "blue";
                                                        ctx2.fillText(totalrevenue+'HRK', cw+2, ch+4, cw);
                                                        ctx2.font="bold 14px bebas"
                                                        ctx2.fillText('revenue per platform', cw+2, ch+14, cw);
                                                        lastend += Math.PI * 2 * (platformrevenue[j]/totalrevenue);

                                                }
                                        }
                                }
                        });
                });
        });

	


	});


    } else {
       	alert("db not found, your browser does not support web sql!");
    }




//function to output the list of cars in the database
function updateGraphs(transaction, results) {
    //initialise the listitems variable
    //var listitems = "";
    //get the car list holder ul
    var listholder = document.getElementById("carlist");

    //clear cars list ul
    listholder.innerHTML = "";

    var i;
    //Iterate through the results
    for (i = 0; i < results.rows.length; i++) {
        //Get the current row
        var row = results.rows.item(i);

        listholder.innerHTML += "<li>" + row.doctor +" - " +  row.pacient + " - " + row.service + " - " + row.platform + " - " + row.price + row.zone + " (<a href='javascript:void(0);' onclick='deleteCar(" + row.id + ");'>Delete</a>)";
    }

}

//function to output the list of cars in the database

function updateCarList(transaction, results) {
        //initialise the listitems variable
	var listitems = "";
        //get the car list holder ul
	var listholder = document.getElementById("carlist");
        //clear cars list ul
	//listholder.innerHTML = "";
	var i;
	var xtable = document.createElement("TABLE");
        //Iterate through the results
    	for (i = 0; i < results.rows.length; i++) {
        //Get the current row
        var row = results.rows.item(i);
                                        xrow = xtable.insertRow(-1);
                                        var xcell0 = xrow.insertCell(0);
                                        xcell0.innerHTML = row.id;
                                        var xcell1 = xrow.insertCell(1);
                                        xcell1.innerHTML = row.doctor;
                                        var xcell2 = xrow.insertCell(2);
                                        xcell2.innerHTML = row.pacient;
                                        var xcell3 = xrow.insertCell(3);
                                        xcell3.innerHTML = row.service;
                                        var xcell4 = xrow.insertCell(4);
                                        xcell3.innerHTML = row.zone;
                                        var xcell5 = xrow.insertCell(5);
                                        xcell5.innerHTML = row.ad;
                                        var xcell6 = xrow.insertCell(6);
                                        xcell6.innerHTML = row.datum;
                                        var xcell7 = xrow.insertCell(7);
                                        xcell7.innerHTML = row.od;
                                        var xcell8 = xrow.insertCell(7);
                                        xcell8.innerHTML = row.do;
                                        var xcell9 = xrow.insertCell(9);
                                        xcell9.innerHTML = row.trajanje;
                                        var xcell10 = xrow.insertCell(10);
                                        xcell10.innerHTML = row.price;
                                        var xcell11 = xrow.insertCell(11);
                                        xcell11.innerHTML = row.invoice;
                                        var xcell12 = xrow.insertCell(12);
                                        xcell12.innerHTML = row.platform;
                                        var xcell13 = xrow.insertCell(13);
                                        xcell13.innerHTML = "(<a href='javascript:void(0);' onclick='deleteCsv(" + row.id + ");'>Delete</a>)";
        //listholder.innerHTML += "<li>" + row.doctor +" - " +  row.pacient + " - " + row.service + " - " + row.platform + " - " + row.price + row.zone + row.datum +" (<a href='javascript:void(0);' onclick='deleteCar(" + row.id + ");'>Delete</a>)";
    	}
	var dvxTable = document.getElementById("dvxTable");
	dvxTable.innerHTML = "";
	dvxTable.appendChild(xtable);
}



function selectDoctor (){

    //if (mydb) {
    if (mydb2) {

       //mydb.transaction(function (t) {
       mydb2.transaction(function (t) {
       		t.executeSql("SELECT * FROM ld WHERE doctor = '" + document.getElementById("doctordropdownlist").value + "'group by platform", [], function (t, results) {
    			var selection = document.getElementById("doctordropdownlist").value;
			var listholder = document.getElementById("graphs");
                	var i;
                        var platformtotalrevenue = 0;
                        var platformrevenue = [0, 0, 0];
                        var platform = ["a", "b", "c"];
    			listholder.innerHTML = "";
			for (i = 0; i < results.rows.length; i++) {
                        	//Get the current row
                        	var row = results.rows.item(i);
                        	platform[i]=row.platform;
    				//listholder.innerHTML += "selected doctor :" + selection;
    				//listholder.innerHTML += "rows length :" + results.rows.length;
    				//listholder.innerHTML += "rows content :" + platform[i];
    				//listholder.innerHTML += "dropdownselection :" + document.getElementById("doctordropdownlist").value;
                	}
       		//mydb.transaction(function (t) {
       		mydb2.transaction(function (t) {
       		t.executeSql("SELECT * FROM ld WHERE doctor = '" + document.getElementById("doctordropdownlist").value + "'", [], function (t, results) {

			var platformtotalrevenue=0;
    			var selection = document.getElementById("doctordropdownlist").value;
			var doctoriosrevenue=0;
			var doctoriosrevenuepercentage=0;
			var doctorandroidrevenue=0;
			var doctorandroidrevenuepercentage=0;
			var doctorwebrevenue=0;
			var doctorwebrevenuepercentage=0;
			var doctortotalrevenue=0;
 	                var canvas5 = document.getElementById("can5");
        	        var ctx5 = canvas5.getContext("2d");
                	ctx5.clearRect(0,0,canvas5.width, canvas5.height);
                	var lastend = 0;
                	var cw=ctx5.canvas.width/2;
                	var ch=ctx5.canvas.height/2;
                	var radius = ctx5.canvas.height/1.5
                	var myColor = ['red','green','blue', 'yellow'];
                	ctx5.font="bold 14px bebas"
                	ctx5.textAlign = 'center';
                        for (i=0; i < results.rows.length; i++) {
                                var row = results.rows.item(i);
                                platformtotalrevenue += parseInt(row.price);
                                        for (j = 0; j < platform.length; j++) {
                                                if (row.platform == platform[j]) {
                                                        platformrevenue[j]+= parseInt(row.price);
    							//listholder.innerHTML += "platform revenue " + j + ":" + platformrevenue[j];
                                                }
                                        if ((i+1)  == results.rows.length) {
                                                        ctx5.fillStyle = myColor[j];
                                                        ctx5.beginPath();
                                                        ctx5.moveTo(cw,ch);
                                                        ctx5.arc(cw,ch,ch,lastend,lastend+(Math.PI*2*(platformrevenue[j]/platformtotalrevenue)),false);
                                                        ctx5.fill();
                                                        ctx5.fillStyle = 'white';
                                                        ctx5.beginPath();
                                                        ctx5.moveTo(cw,ch);
                                                        ctx5.arc(cw,ch,(ch-3),0,2*Math.PI,false);
                                                        ctx5.fill();
                                                        ctx5.fillStyle = "blue";
                                                        ctx5.fillText(platformtotalrevenue.toFixed(0)+'HRK', cw+2, ch+4, cw);
                                                        ctx5.font="bold 16px bebas"
                                                        ctx5.fillText('revenue per platforms', cw+2, ch+14, cw);
                                                        lastend += Math.PI * 2 * (platformrevenue[j]/platformtotalrevenue);
                                                }
                                        }      
			        if (results.rows.item(i).platform == "android") {
					doctorandroidrevenue = Math.round(doctorandroidrevenue) + parseInt(results.rows.item(i).price);				
				} else if (results.rows.item(i).platform == "ios") {
					doctoriosrevenue = Math.round(doctoriosrevenue) +  parseInt(results.rows.item(i).price);
				} else {
					doctorwebrevenue = Math.round(doctorwebrevenue) + parseInt(results.rows.item(i).price);
				}
				doctortotalrevenue = doctortotalrevenue + parseInt(results.rows.item(i).price);
                          	doctoriosrevenuepercentage=(Math.round(doctoriosrevenue)/Math.round(doctortotalrevenue)*100).toFixed(2);
                          	doctorandroidrevenuepercentage=(Math.round(doctorandroidrevenue)/Math.round(doctortotalrevenue)*100).toFixed(2);
                          	doctorwebrevenuepercentage=(Math.round(doctorwebrevenue)/Math.round(doctortotalrevenue)*100).toFixed(2);
			}

                                //chart for ios revenue
                                var al1=0;
                                var id1 = setInterval(frame1,10);
                                function frame1() {
                                var cnv1 = document.getElementById('mycanvas1');
                                var ctx1 = cnv1.getContext('2d');
                                var cw1 = ctx1.canvas.width;
                                var ch1 = ctx1.canvas.height;
                                var start1 = 4.72;
                                diff1 = ((al1 / 100) * Math.PI*2*10).toFixed(2);
                                ctx1.clearRect(0, 0, cw1, ch1);
                                ctx1.lineWidth = 7;
                                ctx1.fillStyle = '#09F';
                                ctx1.strokeStyle = '#09F';
                                ctx1.font="14px bebas"
                                ctx1.textAlign = 'center';
                                ctx1.fillText(al1.toFixed(2)+'%', cw1*.5, ch1*.5+2, cw1);
                                ctx1.fillText('ios', cw1/2+2, ch1/2+14, cw1/2);
                                ctx1.beginPath();
                                ctx1.arc(cw1*.5,ch1*.5,60,start1,diff1/10+start1,false);
                                ctx1.stroke();
                                if (al1 >= doctoriosrevenuepercentage) {
                                      clearInterval(id1);
                                    } else {
                                      al1++;
                                    }
                                }
                                //chart for android revenue
                                var al2=0;
                                var id2 = setInterval(frame2,10);
                                function frame2() {
                                var cnv2 = document.getElementById('mycanvas2');
                                var ctx2 = cnv2.getContext('2d');
                                var cw2 = ctx2.canvas.width;
                                var ch2 = ctx2.canvas.height;
                                var start2 = 4.72;
                                diff2 = ((al2 / 100) * Math.PI*2*10).toFixed(2);
                                ctx2.clearRect(0, 0, cw2, ch2);
                                ctx2.lineWidth = 7;
                                ctx2.fillStyle = '#09F';
                                ctx2.strokeStyle = '#09F';
                                ctx2.font="14px bebas"
                                ctx2.textAlign = 'center';
                                ctx2.fillText(al2.toFixed(2)+'%', cw2*.5, ch2*.5+2, cw2);
                                ctx2.fillText('android', cw2/2+2, ch2/2+14, cw2/2);
                                ctx2.beginPath();
                                ctx2.arc(cw2*.5,ch2*.5,60,start2,diff2/10+start2,false);
                                ctx2.stroke();
                                if (al2 >= doctorandroidrevenuepercentage) {
                                      clearInterval(id2);
                                    } else {
                                      al2++;
                                    }
                                }
                               //chart for web revenue
                                var al3=0;
                                var id3 = setInterval(frame3,10);
                                function frame3() {
                                var cnv3 = document.getElementById('mycanvas3');
                                var ctx3 = cnv3.getContext('2d');
                                var cw3 = ctx3.canvas.width;
                                var ch3 = ctx3.canvas.height;
                                var start3 = 4.72;
                                diff3 = ((al3 / 100) * Math.PI*2*10).toFixed(2);
                                ctx3.clearRect(0, 0, cw3, ch3);
                                ctx3.lineWidth = 7;
                                ctx3.fillStyle = '#09F';
                                ctx3.strokeStyle = '#09F';
                                ctx3.font="14px bebas"
                                ctx3.textAlign = 'center';
                                ctx3.fillText(al3.toFixed(2)+'%', cw3*.5, ch3*.5+2, cw3);
                                ctx3.fillText('web', cw3/2+2, ch3/2+14, cw3/2);
                                ctx3.beginPath();
                                ctx3.arc(cw3*.5,ch3*.5,60,start3,diff3/10+start3,false);
                                ctx3.stroke();
                                if (al3 >= doctorwebrevenuepercentage) {
                                      clearInterval(id3);
                                    } else {
                                      al3++;
                                    }
                                }


                        });
                });
		});
	});

	
	       //mydb.transaction(function (t) {
	       mydb2.transaction(function (t) {
                t.executeSql("SELECT * FROM ld WHERE doctor = '" + document.getElementById("doctordropdownlist").value + "'group by service", [], function (t, results) {
                        var i;
    			var selection = document.getElementById("doctordropdownlist").value;
                        var servicetotalrevenue = 0;
                        var servicerevenue = [0, 0, 0];
                        var service = ["a", "b", "c"];
                        for (i = 0; i < results.rows.length; i++) {
                                //Get the current row
                                var row = results.rows.item(i);
                                service[i]=row.service;
                        }
                //mydb.transaction(function (t) {
                mydb2.transaction(function (t) {
                t.executeSql("SELECT * FROM ld WHERE doctor = '" + document.getElementById("doctordropdownlist").value + "'", [], function (t, results) {

			var canvas6 = document.getElementById("can6");
    			var selection = document.getElementById("doctordropdownlist").value;
                        var ctx6 = canvas6.getContext("2d");
                        ctx6.clearRect(0,0,canvas6.width, canvas6.height);
                        var lastend = 0;
                        var cw=ctx6.canvas.width/2;
                        var ch=ctx6.canvas.height/2;
                        var radius = ctx6.canvas.height/1.5
                        var myColor = ['red','green','blue', 'yellow'];
                        ctx6.font="bold 14px bebas"
                        ctx6.textAlign = 'center';
                        for (i=0; i < results.rows.length; i++) {
                                var row = results.rows.item(i);
                                servicetotalrevenue += parseInt(row.price);
                                        for (j = 0; j < service.length; j++) {
                                                if (row.service == service[j]) {
                                                        servicerevenue[j]+= parseInt(row.price);
                                                }
                                        if ((i+1)  == results.rows.length) {
                                                        ctx6.fillStyle = myColor[j];
                                                        ctx6.beginPath();
                                                        ctx6.moveTo(cw,ch);
                                                        ctx6.arc(cw,ch,ch,lastend,lastend+(Math.PI*2*(servicerevenue[j]/servicetotalrevenue)),false);
                                                        ctx6.fill();
                                                        ctx6.fillStyle = 'white';
                                                        ctx6.beginPath();
                                                        ctx6.moveTo(cw,ch);
                                                        ctx6.arc(cw,ch,(ch-3),0,2*Math.PI,false);
                                                        ctx6.fill();
                                                        ctx6.fillStyle = "blue";
                                                        ctx6.fillText(servicetotalrevenue.toFixed(0)+'HRK', cw+2, ch+4, cw);
                                                        ctx6.font="bold 16px bebas"
                                                        ctx6.fillText('revenue per services', cw+2, ch+14, cw);
                                                        lastend += Math.PI * 2 * (servicerevenue[j]/servicetotalrevenue);
                                                }
                                        }
        			}



				service1revenuepercentage=(servicerevenue[0]/servicetotalrevenue*100).toFixed(2);
				service2revenuepercentage=(servicerevenue[1]/servicetotalrevenue*100).toFixed(2);
				service3revenuepercentage=(servicerevenue[2]/servicetotalrevenue*100).toFixed(2);

                                //chart for ios revenue
                                var al4=0;
                                var id4 = setInterval(frame4,10);
                                function frame4() {
                                var cnv4 = document.getElementById('mycanvas4');
                                var ctx4 = cnv4.getContext('2d');
                                var cw4 = ctx4.canvas.width;
                                var ch4 = ctx4.canvas.height;
                                var start4 = 4.72;
                                diff4 = ((al4 / 100) * Math.PI*2*10).toFixed(2);
                                ctx4.clearRect(0, 0, cw4, ch4);
                                ctx4.lineWidth = 7;
                                ctx4.fillStyle = '#09F';
                                ctx4.strokeStyle = '#09F';
                                ctx4.font="14px bebas"
                                ctx4.textAlign = 'center';
                                ctx4.fillText(al4.toFixed(2)+'%', cw4*.5, ch4*.5+2, ch4);
                                ctx4.fillText('revenue per ' + service[0], cw4/2+2, ch4/2+14, cw4/2);
                                ctx4.beginPath();
                                ctx4.arc(cw4*.5,ch4*.5,60,start4,diff4/10+start4,false);
                                ctx4.stroke();
                                if (al4 >= service1revenuepercentage) {
                                      clearInterval(id4);
                                    } else {
                                      al4++;
                                    }
                                }
 
                                //chart for ios revenue
                                var al5=0;
                                var id5 = setInterval(frame5,10);
                                function frame5() {
                                var cnv5 = document.getElementById('mycanvas5');
                                var ctx5 = cnv5.getContext('2d');
                                var cw5 = ctx5.canvas.width;
                                var ch5 = ctx5.canvas.height;
                                var start5 = 4.72;
                                diff5 = ((al5 / 100) * Math.PI*2*10).toFixed(2);
                                ctx5.clearRect(0, 0, cw5, ch5);
                                ctx5.lineWidth = 7;
                                ctx5.fillStyle = '#09F';
                                ctx5.strokeStyle = '#09F';
                                ctx5.font="14px bebas"
                                ctx5.textAlign = 'center';
                                ctx5.fillText(al5.toFixed(2)+'%', cw5*.5, ch5*.5+2, cw5);
                                ctx5.fillText('revenue per' + service[1], cw5/2+2, ch5/2+14, cw5/2);
                                ctx5.beginPath();
                                ctx5.arc(cw5*.5,ch5*.5,60,start5,diff5/10+start5,false);
                                ctx5.stroke();
                                if (al5 >= service2revenuepercentage) {
                                      clearInterval(id5);
                                    } else {
                                      al5++;
                                    }
                                }


                                //chart for ios revenue
                                var al6=0;
                                var id6 = setInterval(frame6,10);
                                function frame6() {
                                var cnv6 = document.getElementById('mycanvas6');
                                var ctx6 = cnv6.getContext('2d');
                                var cw6 = ctx6.canvas.width;
                                var ch6 = ctx6.canvas.height;
                                var start6 = 4.72;
                                diff6 = ((al6 / 100) * Math.PI*2*10).toFixed(2);
                                ctx6.clearRect(0, 0, cw6, ch6);
                                ctx6.lineWidth = 7;
                                ctx6.fillStyle = '#09F';
                                ctx6.strokeStyle = '#09F';
                                ctx6.font="14px bebas"
                                ctx6.textAlign = 'center';
                                ctx6.fillText(al6.toFixed(2)+'%', cw6*.5, ch6*.5+2, cw6);
                                ctx6.fillText('revenue per' + service[2], cw6/2+2, ch6/2+14, cw6/2);
                                ctx6.beginPath();
                                ctx6.arc(cw6*.5,ch6*.5,60,start6,diff6/10+start6,false);
                                ctx6.stroke();
                                if (al6 >= service3revenuepercentage) {
                                      clearInterval(id6);
                                    } else {
                                      al6++;
                                    }
                                }


			});
		});
	});
	});
 

    } else {
        alert("db not found, your browser does not support web sql!");
    }
}

function selectPacient (){
document.getElementById("selectedpacient").value = document.getElementById("pacientdropdownlist").value;

    //if (mydb) {
    if (mydb2) {
        //Get all the cars from the database with a select statement, set outputCarList as the callback function for the executeSql command
       //mydb.transaction(function (t) {
       mydb2.transaction(function (t) {
       t.executeSql("SELECT * FROM ld WHERE pacient = '" + document.getElementById("selectedpacient").value + "'", [], function (t, results) {

                        //initialise the listitems variable
                        var listitems = "";

                        var i;

                        for (i=0; i < results.rows.length; i++) {

                                }
                        }, null);
                });


    } else {
        alert("db not found, your browser does not support web sql!");
    }
}


function selectService (){
document.getElementById("selectedservice").value = document.getElementById("servicedropdownlist").value;
}

function selectPlatform (){
document.getElementById("selectedplatform").value = document.getElementById("platformdropdownlist").value;
}

function updateDoctorList(transaction, results) {
    //initialise the listitems variable
    var listitems = "";

    var i;
    var txt="";
    //Iterate through the results
    for (i = 0; i < results.rows.length; i++) {
        //Get the current row
        var row = results.rows.item(i);
	 txt=txt + "<option value="+results.rows.item(i).doctor + ">" + results.rows.item(i).doctor + "</option>";

    }
    document.getElementById("doctordropdownlist").innerHTML=txt;
}

function updatePacientList(transaction, results) {


    var i;
    var txt="";
    //Iterate through the results
    for (i = 0; i < results.rows.length; i++) {
        //Get the current row
	var row = results.rows.item(i);
	 txt=txt + "<option value="+results.rows.item(i).pacient + ">" + results.rows.item(i).pacient + "</option>";
    }
    document.getElementById("pacientdropdownlist").innerHTML=txt;
}


function updateServiceList(transaction, results) {

    var i;
    var txt="";
    //Iterate through the results
    for (i = 0; i < results.rows.length; i++) {
        //Get the current row
        var row = results.rows.item(i);
	  txt=txt + "<option value="+results.rows.item(i).service + ">" + results.rows.item(i).service + "</option>";
        }
    document.getElementById("servicedropdownlist").innerHTML=txt;
    }


function updatePlatformList(transaction, results) {

    var i;
    var txt="";
    //Iterate through the results
    for (i = 0; i < results.rows.length; i++) {
        //Get the current row
         var row = results.rows.item(i);
       txt=txt + "<option value="+results.rows.item(i).platform + ">" + results.rows.item(i).platform + "</option>";
    }
    document.getElementById("platformdropdownlist").innerHTML=txt;
}

//function to get the list of cars from the database
function outputCars() {
    //check to ensure the mydb object has been created
    //if (mydb) {
    if (mydb2) {
        //Get all the cars from the database with a select statement, set outputCarList as the callback function for the executeSql command
        //mydb.transaction(function (t) {
        mydb2.transaction(function (t) {
            t.executeSql("SELECT * FROM ld", [], updateCarList);
        });
    } else {
        alert("db not found, your browser does not support web sql!");
    }
}


function outputDoctors() {
    //check to ensure the mydb object has been created
    //if (mydb) {
    if (mydb2) {
        //Get all the cars from the database with a select statement, set outputCarList as the callback function for the executeSql command
        //mydb.transaction(function (t) {
        mydb2.transaction(function (t) {
            t.executeSql("SELECT * FROM ld group by doctor", [], updateDoctorList);
        });
    } else {
        alert("db not found, your browser does not support web sql!");
    }
}


function outputPacient() {
    //check to ensure the mydb object has been created
    //if (mydb) {
    if (mydb2) {
        //Get all the cars from the database with a select statement, set outputCarList as the callback function for the executeSql command
        //mydb.transaction(function (t) {
        mydb2.transaction(function (t) {
            t.executeSql("SELECT * FROM ld group by pacient", [], updatePacientList);
        });
    } else {
        alert("db not found, your browser does not support web sql!");
    }
}


function outputServices() {
    //check to ensure the mydb object has been created
    //if (mydb) {
    if (mydb2) {
        //Get all the cars from the database with a select statement, set outputCarList as the callback function for the executeSql command
        //mydb.transaction(function (t) {
        mydb2.transaction(function (t) {
            t.executeSql("SELECT * FROM ld group by service", [], updateServiceList);
        });
    } else {
        alert("db not found, your browser does not support web sql!");
    }
}

function outputPlatform() {
    //check to ensure the mydb object has been created
    //if (mydb) {
    if (mydb2) {
        //Get all the cars from the database with a select statement, set outputCarList as the callback function for the executeSql command
        //mydb.transaction(function (t) {
        mydb2.transaction(function (t) {
            t.executeSql("SELECT * FROM ld group by platform", [], updatePlatformList);
        });
    } else {
        alert("db not found, your browser does not support web sql!");
    }
}


//function to add the car to the database

function addCar() {
    //check to ensure the mydb object has been created
    //if (mydb) {
    if (mydb2) {
        //get the values of the make and model text inputs
//        var make = document.getElementById("carmake").value;
//        var model = document.getElementById("carmodel").value;
        var doctor = document.getElementById("doctor").value;
        var pacient = document.getElementById("pacient").value;
        var service = document.getElementById("service").value;
        var zone = document.getElementById("zone").value;
        var ad = document.getElementById("ad").value;
        var date = document.getElementById("date").value;
        var start = document.getElementById("start").value;
        var end = document.getElementById("end").value;
        var duration = document.getElementById("duration").value;
        var price = document.getElementById("price").value;
        var invoice = document.getElementById("invoice").value;
        var platform = document.getElementById("platform").value;

        //Test to ensure that the user has entered both a make and model
        if (doctor !== "" && pacient !== "") {
            //Insert the user entered details into the cars table, note the use of the ? placeholder, these will replaced by the data passed in as an array as the second parameter
            //mydb.transaction(function (t) {
            mydb2.transaction(function (t) {
                t.executeSql("INSERT INTO ld (doctor, pacient, service, zone, ad, date, start, end, duration, price, invoice, platform) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)", [doctor, pacient, service, zone, ad, date, start, end, duration, price, invoice, platform]);
                outputCars();
            });
        } else {
            alert("You must enter a doctor and pacient and service  and platform!");
        }
    } else {
        alert("db not found, your browser does not support web sql!");
    }
}


//function to remove a car from the database, passed the row id as it's only parameter

function deleteCar(id) {
    //check to ensure the mydb object has been created
    //if (mydb) {
    if (mydb2) {
        //Get all the cars from the database with a select statement, set outputCarList as the callback function for the executeSql command
        //mydb.transaction(function (t) {
        mydb2.transaction(function (t) {
            t.executeSql("DELETE FROM ld WHERE id=?", [id], outputCars);
        });
    } else {
        alert("db not found, your browser does not support web sql!");
    }
}


outputCars();
outputDoctors();
outputPacient();
outputServices();
outputPlatform();

</script>
</CENTER>
</BODY>
</HTML>
